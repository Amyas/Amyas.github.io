<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>7、HTTP缓存 | Amyas &#39; Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="技术沉淀">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.30c10ab0.css" as="style"><link rel="preload" href="/assets/js/app.3063c5d8.js" as="script"><link rel="preload" href="/assets/js/2.142bab56.js" as="script"><link rel="preload" href="/assets/js/136.b851a046.js" as="script"><link rel="prefetch" href="/assets/js/10.870375df.js"><link rel="prefetch" href="/assets/js/100.e0d1b3b5.js"><link rel="prefetch" href="/assets/js/101.e13641aa.js"><link rel="prefetch" href="/assets/js/102.e65be799.js"><link rel="prefetch" href="/assets/js/103.31b11e0f.js"><link rel="prefetch" href="/assets/js/104.f5a4e18d.js"><link rel="prefetch" href="/assets/js/105.ec3cb0f3.js"><link rel="prefetch" href="/assets/js/106.419d76b1.js"><link rel="prefetch" href="/assets/js/107.ea6ab194.js"><link rel="prefetch" href="/assets/js/108.3a64ff98.js"><link rel="prefetch" href="/assets/js/109.060b9d1f.js"><link rel="prefetch" href="/assets/js/11.4d9933bf.js"><link rel="prefetch" href="/assets/js/110.8307210e.js"><link rel="prefetch" href="/assets/js/111.39d0153e.js"><link rel="prefetch" href="/assets/js/112.8df33ffc.js"><link rel="prefetch" href="/assets/js/113.452f15c3.js"><link rel="prefetch" href="/assets/js/114.68010e56.js"><link rel="prefetch" href="/assets/js/115.3f3d9798.js"><link rel="prefetch" href="/assets/js/116.b26b662a.js"><link rel="prefetch" href="/assets/js/117.3837fc5f.js"><link rel="prefetch" href="/assets/js/118.7e7d6c1c.js"><link rel="prefetch" href="/assets/js/119.76327a77.js"><link rel="prefetch" href="/assets/js/12.5168b6cf.js"><link rel="prefetch" href="/assets/js/120.b42a432d.js"><link rel="prefetch" href="/assets/js/121.9f712ed9.js"><link rel="prefetch" href="/assets/js/122.900aca16.js"><link rel="prefetch" href="/assets/js/123.f7cb9c78.js"><link rel="prefetch" href="/assets/js/124.9f612b11.js"><link rel="prefetch" href="/assets/js/125.25ea174c.js"><link rel="prefetch" href="/assets/js/126.fc8a8002.js"><link rel="prefetch" href="/assets/js/127.7d091ca5.js"><link rel="prefetch" href="/assets/js/128.20b613c2.js"><link rel="prefetch" href="/assets/js/129.662b23c1.js"><link rel="prefetch" href="/assets/js/13.3b7e2466.js"><link rel="prefetch" href="/assets/js/130.6e4acbe7.js"><link rel="prefetch" href="/assets/js/131.d03b6e3a.js"><link rel="prefetch" href="/assets/js/132.84b21cc0.js"><link rel="prefetch" href="/assets/js/133.731282bf.js"><link rel="prefetch" href="/assets/js/134.5bc8f4c4.js"><link rel="prefetch" href="/assets/js/135.19aee10a.js"><link rel="prefetch" href="/assets/js/137.cd52907b.js"><link rel="prefetch" href="/assets/js/138.fce6b283.js"><link rel="prefetch" href="/assets/js/139.df86adec.js"><link rel="prefetch" href="/assets/js/14.6d36d9f1.js"><link rel="prefetch" href="/assets/js/140.db10dbad.js"><link rel="prefetch" href="/assets/js/141.3de1b3a4.js"><link rel="prefetch" href="/assets/js/142.f175fc20.js"><link rel="prefetch" href="/assets/js/143.5940e5f9.js"><link rel="prefetch" href="/assets/js/144.532466f0.js"><link rel="prefetch" href="/assets/js/145.cb7fed17.js"><link rel="prefetch" href="/assets/js/146.cd0388c2.js"><link rel="prefetch" href="/assets/js/147.d4d85d8a.js"><link rel="prefetch" href="/assets/js/148.fd8c88a6.js"><link rel="prefetch" href="/assets/js/149.4c550f16.js"><link rel="prefetch" href="/assets/js/15.80993aef.js"><link rel="prefetch" href="/assets/js/150.1a1633dc.js"><link rel="prefetch" href="/assets/js/151.8f9e30cb.js"><link rel="prefetch" href="/assets/js/152.c91389b0.js"><link rel="prefetch" href="/assets/js/153.8966710d.js"><link rel="prefetch" href="/assets/js/154.fe7c243d.js"><link rel="prefetch" href="/assets/js/155.de2d57a6.js"><link rel="prefetch" href="/assets/js/156.9d07aef9.js"><link rel="prefetch" href="/assets/js/157.99be1cae.js"><link rel="prefetch" href="/assets/js/158.1e5da402.js"><link rel="prefetch" href="/assets/js/159.aea92228.js"><link rel="prefetch" href="/assets/js/16.c7b390d6.js"><link rel="prefetch" href="/assets/js/160.db43438b.js"><link rel="prefetch" href="/assets/js/161.dfa158d4.js"><link rel="prefetch" href="/assets/js/162.23c1c294.js"><link rel="prefetch" href="/assets/js/163.05b05207.js"><link rel="prefetch" href="/assets/js/164.d7975f25.js"><link rel="prefetch" href="/assets/js/165.e48354b0.js"><link rel="prefetch" href="/assets/js/166.c14f3e48.js"><link rel="prefetch" href="/assets/js/167.fbd13710.js"><link rel="prefetch" href="/assets/js/168.fe8c47ba.js"><link rel="prefetch" href="/assets/js/169.a8980c54.js"><link rel="prefetch" href="/assets/js/17.e838465d.js"><link rel="prefetch" href="/assets/js/170.1964a9af.js"><link rel="prefetch" href="/assets/js/171.6d6387d1.js"><link rel="prefetch" href="/assets/js/172.b0cd7467.js"><link rel="prefetch" href="/assets/js/173.f2728f26.js"><link rel="prefetch" href="/assets/js/174.6d6cc289.js"><link rel="prefetch" href="/assets/js/175.42ab5de0.js"><link rel="prefetch" href="/assets/js/176.369f58a9.js"><link rel="prefetch" href="/assets/js/177.553f3f69.js"><link rel="prefetch" href="/assets/js/178.77ad77e1.js"><link rel="prefetch" href="/assets/js/179.f377ebd2.js"><link rel="prefetch" href="/assets/js/18.ae657066.js"><link rel="prefetch" href="/assets/js/180.f9c4d3ab.js"><link rel="prefetch" href="/assets/js/181.8c234019.js"><link rel="prefetch" href="/assets/js/182.d8815350.js"><link rel="prefetch" href="/assets/js/183.0bc6365a.js"><link rel="prefetch" href="/assets/js/184.8914a413.js"><link rel="prefetch" href="/assets/js/185.e757a1d7.js"><link rel="prefetch" href="/assets/js/186.3ffebe9d.js"><link rel="prefetch" href="/assets/js/187.cd8113b7.js"><link rel="prefetch" href="/assets/js/188.21178de4.js"><link rel="prefetch" href="/assets/js/189.1a909e8d.js"><link rel="prefetch" href="/assets/js/19.d4a4bb4a.js"><link rel="prefetch" href="/assets/js/190.b9275dc3.js"><link rel="prefetch" href="/assets/js/191.6712ea54.js"><link rel="prefetch" href="/assets/js/192.3665d5d1.js"><link rel="prefetch" href="/assets/js/193.d709b611.js"><link rel="prefetch" href="/assets/js/194.311f0879.js"><link rel="prefetch" href="/assets/js/195.1e7b4ada.js"><link rel="prefetch" href="/assets/js/196.2b560d2e.js"><link rel="prefetch" href="/assets/js/197.e3932a25.js"><link rel="prefetch" href="/assets/js/198.a1e9dd2f.js"><link rel="prefetch" href="/assets/js/199.9ffd93d6.js"><link rel="prefetch" href="/assets/js/20.e64189a8.js"><link rel="prefetch" href="/assets/js/200.5b501ed4.js"><link rel="prefetch" href="/assets/js/201.de0094d8.js"><link rel="prefetch" href="/assets/js/202.e1b7a269.js"><link rel="prefetch" href="/assets/js/203.ab75038f.js"><link rel="prefetch" href="/assets/js/204.b17eccd7.js"><link rel="prefetch" href="/assets/js/205.c2455e4a.js"><link rel="prefetch" href="/assets/js/206.c1aacc36.js"><link rel="prefetch" href="/assets/js/207.a523db3b.js"><link rel="prefetch" href="/assets/js/208.b4b5c182.js"><link rel="prefetch" href="/assets/js/209.ef8b60ee.js"><link rel="prefetch" href="/assets/js/21.3bac6f16.js"><link rel="prefetch" href="/assets/js/210.f7687087.js"><link rel="prefetch" href="/assets/js/211.02baf9c4.js"><link rel="prefetch" href="/assets/js/212.13c9c8c6.js"><link rel="prefetch" href="/assets/js/213.87d9ff96.js"><link rel="prefetch" href="/assets/js/214.613e6d77.js"><link rel="prefetch" href="/assets/js/215.93b90c6a.js"><link rel="prefetch" href="/assets/js/216.2671c2ce.js"><link rel="prefetch" href="/assets/js/217.ee65a5d6.js"><link rel="prefetch" href="/assets/js/218.ddc0f5e0.js"><link rel="prefetch" href="/assets/js/219.30be1124.js"><link rel="prefetch" href="/assets/js/22.777c8a10.js"><link rel="prefetch" href="/assets/js/220.b03b8d49.js"><link rel="prefetch" href="/assets/js/221.fb0119c0.js"><link rel="prefetch" href="/assets/js/222.90b26f9a.js"><link rel="prefetch" href="/assets/js/223.14921547.js"><link rel="prefetch" href="/assets/js/224.7a6b10cf.js"><link rel="prefetch" href="/assets/js/225.fc5bd0fa.js"><link rel="prefetch" href="/assets/js/226.ac3e1e1c.js"><link rel="prefetch" href="/assets/js/227.a6321f13.js"><link rel="prefetch" href="/assets/js/228.675bda7f.js"><link rel="prefetch" href="/assets/js/229.73486850.js"><link rel="prefetch" href="/assets/js/23.268b0363.js"><link rel="prefetch" href="/assets/js/230.a1908891.js"><link rel="prefetch" href="/assets/js/231.93c24b8b.js"><link rel="prefetch" href="/assets/js/232.ac3eeed5.js"><link rel="prefetch" href="/assets/js/233.35b8bf97.js"><link rel="prefetch" href="/assets/js/234.77f187be.js"><link rel="prefetch" href="/assets/js/24.4c68ae4c.js"><link rel="prefetch" href="/assets/js/25.1684bb08.js"><link rel="prefetch" href="/assets/js/26.0acd6eb1.js"><link rel="prefetch" href="/assets/js/27.9ca6beee.js"><link rel="prefetch" href="/assets/js/28.5f5fd335.js"><link rel="prefetch" href="/assets/js/29.9170d5f5.js"><link rel="prefetch" href="/assets/js/3.dc7584b8.js"><link rel="prefetch" href="/assets/js/30.e456152b.js"><link rel="prefetch" href="/assets/js/31.e0476157.js"><link rel="prefetch" href="/assets/js/32.38a2a5dd.js"><link rel="prefetch" href="/assets/js/33.87d27c99.js"><link rel="prefetch" href="/assets/js/34.abd881c0.js"><link rel="prefetch" href="/assets/js/35.733a70c5.js"><link rel="prefetch" href="/assets/js/36.ba31cd0c.js"><link rel="prefetch" href="/assets/js/37.f990ecf4.js"><link rel="prefetch" href="/assets/js/38.7a4c5593.js"><link rel="prefetch" href="/assets/js/39.e4a6405f.js"><link rel="prefetch" href="/assets/js/4.c94d32e3.js"><link rel="prefetch" href="/assets/js/40.6d895bb4.js"><link rel="prefetch" href="/assets/js/41.d74b777c.js"><link rel="prefetch" href="/assets/js/42.332f03db.js"><link rel="prefetch" href="/assets/js/43.71194ce2.js"><link rel="prefetch" href="/assets/js/44.fae6fd3e.js"><link rel="prefetch" href="/assets/js/45.2635ea62.js"><link rel="prefetch" href="/assets/js/46.385a71ab.js"><link rel="prefetch" href="/assets/js/47.d13ffdb5.js"><link rel="prefetch" href="/assets/js/48.c07f3160.js"><link rel="prefetch" href="/assets/js/49.64fb2ade.js"><link rel="prefetch" href="/assets/js/5.9d37338b.js"><link rel="prefetch" href="/assets/js/50.22569d48.js"><link rel="prefetch" href="/assets/js/51.1d12d9db.js"><link rel="prefetch" href="/assets/js/52.88972318.js"><link rel="prefetch" href="/assets/js/53.4faf1e5f.js"><link rel="prefetch" href="/assets/js/54.234f1269.js"><link rel="prefetch" href="/assets/js/55.7fc062db.js"><link rel="prefetch" href="/assets/js/56.eea631f7.js"><link rel="prefetch" href="/assets/js/57.ef01ea61.js"><link rel="prefetch" href="/assets/js/58.dc76c3f8.js"><link rel="prefetch" href="/assets/js/59.b80ab0ac.js"><link rel="prefetch" href="/assets/js/6.a7b8c3b7.js"><link rel="prefetch" href="/assets/js/60.a65c579d.js"><link rel="prefetch" href="/assets/js/61.c1bce18a.js"><link rel="prefetch" href="/assets/js/62.a08cf5da.js"><link rel="prefetch" href="/assets/js/63.a38e0523.js"><link rel="prefetch" href="/assets/js/64.80980a97.js"><link rel="prefetch" href="/assets/js/65.94637baf.js"><link rel="prefetch" href="/assets/js/66.c234bc1e.js"><link rel="prefetch" href="/assets/js/67.394d076b.js"><link rel="prefetch" href="/assets/js/68.c9e7196e.js"><link rel="prefetch" href="/assets/js/69.dae1bf82.js"><link rel="prefetch" href="/assets/js/7.d00dff6d.js"><link rel="prefetch" href="/assets/js/70.3ecf96b7.js"><link rel="prefetch" href="/assets/js/71.90d2248a.js"><link rel="prefetch" href="/assets/js/72.9f950f95.js"><link rel="prefetch" href="/assets/js/73.0d7b33ad.js"><link rel="prefetch" href="/assets/js/74.96afd12d.js"><link rel="prefetch" href="/assets/js/75.7df12693.js"><link rel="prefetch" href="/assets/js/76.8b2ef40f.js"><link rel="prefetch" href="/assets/js/77.70819900.js"><link rel="prefetch" href="/assets/js/78.2176c7c9.js"><link rel="prefetch" href="/assets/js/79.404440ee.js"><link rel="prefetch" href="/assets/js/8.342afa4c.js"><link rel="prefetch" href="/assets/js/80.5c58d508.js"><link rel="prefetch" href="/assets/js/81.dd98c988.js"><link rel="prefetch" href="/assets/js/82.1e7d077a.js"><link rel="prefetch" href="/assets/js/83.5170386e.js"><link rel="prefetch" href="/assets/js/84.76a55dd2.js"><link rel="prefetch" href="/assets/js/85.cc30904b.js"><link rel="prefetch" href="/assets/js/86.60735143.js"><link rel="prefetch" href="/assets/js/87.db85f2fd.js"><link rel="prefetch" href="/assets/js/88.b67113f0.js"><link rel="prefetch" href="/assets/js/89.20955e32.js"><link rel="prefetch" href="/assets/js/9.7e3f1dbd.js"><link rel="prefetch" href="/assets/js/90.00da2ae6.js"><link rel="prefetch" href="/assets/js/91.b30d3056.js"><link rel="prefetch" href="/assets/js/92.da7c33e2.js"><link rel="prefetch" href="/assets/js/93.48c9938f.js"><link rel="prefetch" href="/assets/js/94.760a7ebf.js"><link rel="prefetch" href="/assets/js/95.a8c0271e.js"><link rel="prefetch" href="/assets/js/96.83cadb40.js"><link rel="prefetch" href="/assets/js/97.11510887.js"><link rel="prefetch" href="/assets/js/98.bc72f691.js"><link rel="prefetch" href="/assets/js/99.e0af27f2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.30c10ab0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Amyas ' Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/interview-questions/" class="nav-link router-link-active">
  总结
</a></div><div class="nav-item"><a href="/frontend-engineering/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/design-mode/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/data-structure-and-algorithm/" class="nav-link">
  数据结构与算法
</a></div><div class="nav-item"><a href="/cplus-reverse/" class="nav-link">
  C++逆向
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/interview-questions/" class="nav-link router-link-active">
  总结
</a></div><div class="nav-item"><a href="/frontend-engineering/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/design-mode/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/data-structure-and-algorithm/" class="nav-link">
  数据结构与算法
</a></div><div class="nav-item"><a href="/cplus-reverse/" class="nav-link">
  C++逆向
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>0、HTTP</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview-questions/0、HTTP/1.html" class="sidebar-link">1、HTTP1.0/1.1/2区别</a></li><li><a href="/interview-questions/0、HTTP/2.html" class="sidebar-link">2、HTTP和HTTPS</a></li><li><a href="/interview-questions/0、HTTP/3.html" class="sidebar-link">3、DNS协议</a></li><li><a href="/interview-questions/0、HTTP/4.html" class="sidebar-link">4、TCP三次握手、四次挥手</a></li><li><a href="/interview-questions/0、HTTP/5.html" class="sidebar-link">5、从输入URL到页面渲染都发生了什么</a></li><li><a href="/interview-questions/0、HTTP/6.html" class="sidebar-link">6、GET和POST有什么区别</a></li><li><a href="/interview-questions/0、HTTP/7.html" class="active sidebar-link">7、HTTP缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview-questions/0、HTTP/7.html#缓存相关header" class="sidebar-link">缓存相关header</a></li><li class="sidebar-sub-header"><a href="/interview-questions/0、HTTP/7.html#浏览器是如何判断是否使用缓存的" class="sidebar-link">浏览器是如何判断是否使用缓存的</a></li><li class="sidebar-sub-header"><a href="/interview-questions/0、HTTP/7.html#_0、缓存实际阐述" class="sidebar-link">0、缓存实际阐述</a></li><li class="sidebar-sub-header"><a href="/interview-questions/0、HTTP/7.html#_1、原始模型" class="sidebar-link">1、原始模型</a></li><li class="sidebar-sub-header"><a href="/interview-questions/0、HTTP/7.html#_2、浏览器增加缓存机制" class="sidebar-link">2、浏览器增加缓存机制</a></li><li class="sidebar-sub-header"><a href="/interview-questions/0、HTTP/7.html#_3、服务器和浏览器约定资源过期时间" class="sidebar-link">3、服务器和浏览器约定资源过期时间</a></li><li class="sidebar-sub-header"><a href="/interview-questions/0、HTTP/7.html#_4、服务器告诉浏览器资源上次修改时间" class="sidebar-link">4、服务器告诉浏览器资源上次修改时间</a></li><li class="sidebar-sub-header"><a href="/interview-questions/0、HTTP/7.html#_5、继续改进-增加相对时间的控制-引入cache-contorl" class="sidebar-link">5、继续改进，增加相对时间的控制，引入Cache-Contorl</a></li><li class="sidebar-sub-header"><a href="/interview-questions/0、HTTP/7.html#_6、继续改进-增加文件内容对比-引入etag" class="sidebar-link">6、继续改进，增加文件内容对比，引入Etag</a></li><li class="sidebar-sub-header"><a href="/interview-questions/0、HTTP/7.html#_7、结束了吗" class="sidebar-link">7、结束了吗？</a></li><li class="sidebar-sub-header"><a href="/interview-questions/0、HTTP/7.html#_8、最终方案" class="sidebar-link">8、最终方案</a></li><li class="sidebar-sub-header"><a href="/interview-questions/0、HTTP/7.html#_9、补充" class="sidebar-link">9、补充</a></li></ul></li><li><a href="/interview-questions/0、HTTP/8.html" class="sidebar-link">8、跨域</a></li><li><a href="/interview-questions/0、HTTP/9.html" class="sidebar-link">9、Cookie</a></li><li><a href="/interview-questions/0、HTTP/questions.html" class="sidebar-link">Questions</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1、HTML&amp;CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2、JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>3、ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>4、Async</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5、Mobile</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>6、Vue2</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>8、Vue3</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_7、http缓存"><a href="#_7、http缓存" class="header-anchor">#</a> 7、HTTP缓存</h1> <h2 id="缓存相关header"><a href="#缓存相关header" class="header-anchor">#</a> 缓存相关header</h2> <p>我们先罗列一下和缓存相关的请求响应头。</p> <h3 id="强缓存"><a href="#强缓存" class="header-anchor">#</a> 强缓存</h3> <ul><li>Expires</li></ul> <p><strong>响应头，代表该资源的过期时间</strong></p> <ul><li>Cache-Control</li></ul> <p><strong>请求/响应头，缓存控制字段，精确控制缓存策略</strong></p> <p>服务器不会向服务器发送任何请求，直接从本地缓存中读取文件并返回Statu Code: 200 ok</p> <img src="https://raw.githubusercontent.com/Amyas/picgo-bed/master/amyas.github.io/72022-04-15-15-23-27.png" alt="72022-04-15-15-23-27" width="" height=""> <p><strong>200 from memory cache: 不访问服务器，一般已经加载过该资源且缓存在了内容当中，直接从内存中读取缓存。浏览器关闭后，数据将不存在（资源被释放掉了），再次打开相同的页面时，不会出现from memory cache。</strong></p> <p><strong>200 from disk cache：不访问服务器，已经在之前的某个时间加载过该资源，直接从硬盘中读取缓存，关闭浏览器后，数据依然存在，此资源不会随着该页面的关闭而释放掉，下次打开仍然会是from disk cache。</strong></p> <p><strong>优先访问memory cache，其次是disk cache，最后是请求网络资源。</strong></p> <p><strong>expires是http1.0的头字段，cache-control是http1.1的头字段。如果同时存在，cache-control会覆盖expires，建立两个都写</strong></p> <h3 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h3> <ul><li>If-Modified-Since</li></ul> <p><strong>请求头，资源最近修改时间，由浏览器告诉服务器</strong></p> <ul><li>Last-Modified</li></ul> <p><strong>响应头，资源最近修改时间，由服务器告诉浏览器</strong></p> <ul><li>Etag</li></ul> <p><strong>响应头，资源标识，由服务器告诉浏览器</strong></p> <ul><li>If-None-Match</li></ul> <p><strong>请求头，缓存资源标识，由浏览器告诉服务器</strong></p> <p>向服务器发送请求，服务器会根据这个请求的request header的一些参数来判断是否命中协商缓存，如果命中，则返回304状态吗并带上新的response header通知浏览器从缓存中读取资源</p> <p>协商缓存头是成对出现</p> <p>配对使用的字段：</p> <ul><li>If-Modified-Since和LastModified</li> <li>Etag和If-None-Match</li></ul> <h2 id="浏览器是如何判断是否使用缓存的"><a href="#浏览器是如何判断是否使用缓存的" class="header-anchor">#</a> 浏览器是如何判断是否使用缓存的</h2> <p>第一次请求：</p> <img src="https://raw.githubusercontent.com/Amyas/picgo-bed/master/amyas.github.io/72022-04-15-15-19-49.png" alt="72022-04-15-15-19-49" width="" height=""> <p>第二次请求相同资源：</p> <img src="https://raw.githubusercontent.com/Amyas/picgo-bed/master/amyas.github.io/72022-04-15-15-20-07.png" alt="72022-04-15-15-20-07" width="" height=""> <h2 id="_0、缓存实际阐述"><a href="#_0、缓存实际阐述" class="header-anchor">#</a> 0、缓存实际阐述</h2> <p>今天着重介绍一下浏览器缓存机制，我们知道，浏览器缓存一般是针对静态资源，比如js、css、图片等，所以我们下面的例子围绕一个js文件a.js来阐述，抛开理论式灌输，我们从实际场景出发，一点点完善缓存机制，这种方式，相信大家也回更容易理解。</p> <p>做一些约定，方便后续比较。</p> <ul><li>a.js大小为10kb</li> <li>请求头约定为1kb</li> <li>响应头约定为1kb</li></ul> <h2 id="_1、原始模型"><a href="#_1、原始模型" class="header-anchor">#</a> 1、原始模型</h2> <ul><li>浏览器请求静态资源a.js。（请求头：1kb）</li> <li>服务器读取磁盘文件a.js，返给浏览器。（10kb（a.js） + 1kb（响应头） = 11kb）</li> <li>浏览器再次请求，服务器又重新读取磁盘文件a.js，反给浏览器</li> <li>如此循环...</li></ul> <p>执行一个往返，流量为10(a.js) + 1(请求头) + 1(响应头) = 12kb</p> <p>访问10次，流量大约为12 * 10 = 120kb</p> <p>所以，流量与访问次数有关：</p> <p>L(流量) = N(访问次数) * 12</p> <p>该方式缺点很明显：</p> <ul><li>浪费用户流量</li> <li>浪费服务器资源，服务器要读取磁盘文件，然后发送文件到浏览器</li> <li>浏览器要等待a.js下载并且执行后才能渲染页面，影响用户体验</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>js执行时间相比下载时间要快得多，如果能优化下载时间，用户体验会提升很多</p></div> <h2 id="_2、浏览器增加缓存机制"><a href="#_2、浏览器增加缓存机制" class="header-anchor">#</a> 2、浏览器增加缓存机制</h2> <ul><li>浏览器第一次请求a.js，缓存a.js到本地磁盘(1 + 10 + 1 = 12kb)</li> <li>浏览器再次请求a.js，直接走浏览器缓存(200， from cache)，不再向服务器发起请求(0kb)</li></ul> <p>第一次访问，流量为1 + 10 + 1 = 12kb，第二次访问流量为0，第1000次访问，流量依然为0</p> <p>所以流量与访问次数有关：</p> <p>L(流量) = 12kb</p> <p>优点：</p> <ul><li>大大减少贷款</li> <li>由于减少了a.js下载时间，响应的提高了用户体验</li></ul> <p>缺点：服务器上a.js更新时，浏览器感知不到，拿不到最近的js资源</p> <h2 id="_3、服务器和浏览器约定资源过期时间"><a href="#_3、服务器和浏览器约定资源过期时间" class="header-anchor">#</a> 3、服务器和浏览器约定资源过期时间</h2> <p>服务器和浏览器约定文件过期时间，用<code>Expires</code>字段来控制，时间是GMT格式的标准时间，如Fri, 01 Jan 1990 00:00:00 GMT。</p> <ul><li>浏览器第一次请求一个静态资源a.js(1kb)</li> <li>服务器把a.js和a.js的缓存过期时间(Expires: Mon, 26 Sep 2018 05:00:00 GMT)发送给浏览器(10 + 1 = 11kb)</li></ul> <p>服务器告诉浏览器：你把我发给你的a.js文件缓存到你那里，在2018年9月26日5点之前不要在发请求烦我，直接使用你自己缓存的a.js就行了。</p> <ul><li>浏览器接收到a.js，同时记住了过期时间</li> <li>在2018年9月26日5点之前，浏览器再次请求a.js，便不再请求服务器，直接使用上一次缓存的a.js文件(0kb)</li> <li>在2018年9月26日5点01分，浏览器请求a.js，发现a.js缓存时间过了，于是不再使用本地缓存，而是请求服务器，服务器又重新读取磁盘文件a.js，返给浏览器，同时告诉浏览器一个新的过期时间(1+10+1=12kb)</li> <li>如此往复...</li></ul> <p>该种方式较之前的方式有了很大的改善：</p> <ul><li>在过期时间以内，为用户省了很多流量</li> <li>减少了服务器重复读取磁盘文件的压力</li> <li>缓存过期后，能够得到最新的a.js文件</li></ul> <p>缺点还是有：</p> <ul><li>缓存过期以后，服务器不管a.js有没有变化，都会再次读取a.js文件，并返给浏览器</li></ul> <h2 id="_4、服务器告诉浏览器资源上次修改时间"><a href="#_4、服务器告诉浏览器资源上次修改时间" class="header-anchor">#</a> 4、服务器告诉浏览器资源上次修改时间</h2> <p>为了解决上个方案的问题，服务器和浏览器经过磋商，制定了一种方案，服务器每次返回a.js的时候，还是要告诉浏览器a.js在服务器上最近修改时间<code>Last-Modified</code>(GMT标准格式)</p> <ul><li>浏览器访问a.js文件(1kb)</li> <li>服务器返回a.js的时候，告诉浏览器a.js文件(10 + 1 = 11kb)在服务器的上次修改时间<code>Last-Modified</code>(GMT标准格式)以及缓存过期时间<code>Expires</code>(GMT标准格式)</li> <li>当a.js文件过期时，浏览器带上<code>If-Modified-Since</code>(等于上一次请求的Last-Modified)请求服务器(1kb)</li> <li>服务器比较请求头里的<code>Last-Modified</code>时间和服务器上a.js的上次修改时间：
<ul><li>如果一致，则告诉浏览器：你可以继续使用本地缓存(304)，此时，服务器不再返回a.js文件(1kb)</li> <li>如果不一致，服务器读取 磁盘上的a.js文件放给浏览器，同时告诉浏览器a.js的最近的修改时间<code>Last-Modified</code>以及过期时间<code>Expires</code>(1+10=11kb)</li> <li>如此往复</li></ul></li></ul> <p>此种方案比上一个方案有了更进一步的优化：</p> <ul><li>缓存过期后，服务器检测如果文件没变化，不再把a.js，不再把a.js发给浏览器，省去了10kb的流量</li> <li>缓存过期后，服务器检测文件有变化，则把最新的a.js发给浏览器，浏览器能够得到最新的a.js</li></ul> <p>缺点：</p> <ul><li>Expires过期控制不稳定，因为浏览器可以随意修改时间，导致缓存使用不准</li> <li>Last-Modified过期时间只能精确到秒</li></ul> <p>精确到秒存在两个问题：</p> <ol><li><p>如果a.js在一秒时间内经常变动，同时服务器给a.js设置无缓存，那浏览器每次访问a.js，都会请求服务器，此时服务器比较发给浏览器的上次修改时间和a.js最近修改时间，发现都是在同一时间(因为精确到秒)，因此返回给浏览器继续使用本地缓存的消息(304)，但事实上服务器上的a.js已经改动了好多次了，所以这种情况，浏览器拿不到最新的a.js文件。</p></li> <li><p>如果在服务器上a.js被修改了，但其实际内容根本没发生变化，会因为Last-Modified时间匹配不上而重新返回a.js给浏览器</p></li></ol> <h2 id="_5、继续改进-增加相对时间的控制-引入cache-contorl"><a href="#_5、继续改进-增加相对时间的控制-引入cache-contorl" class="header-anchor">#</a> 5、继续改进，增加相对时间的控制，引入Cache-Contorl</h2> <p>为了兼容已经实现了上述方案的浏览器，同时加入新的缓存方案，服务器除了告诉浏览器Expires，同时告诉浏览器一个相对时间Cache-Control: max-age=10秒。意思是在10秒以内，使用缓存到浏览器的a.js资源。</p> <p>浏览器先检查Cache-Control，如果有，则以Cache-Control为准，忽略Expires，如果没有Cache-Control，则以Expires为准。</p> <h2 id="_6、继续改进-增加文件内容对比-引入etag"><a href="#_6、继续改进-增加文件内容对比-引入etag" class="header-anchor">#</a> 6、继续改进，增加文件内容对比，引入Etag</h2> <p>为了解决文件修改之间只能精确到秒带来的问题，我们给服务器引入Etag响应头，a.js内容变了，Etag才变，内容不变，Etag不变，可以理解为Etag是文件内容的唯一ID。同时引入对应的请求头If-None-Match，每次浏览器请求服务器的时候，都带上If-None-Match字段，该字段的值就是上次请求a.js时，服务器返给浏览器的Etag。</p> <ul><li>浏览器请求a.js</li> <li>服务器返回a.js，同时告诉浏览器过期绝对时间(Expires)以及相对时间(Cache-Control: max-age=10)，以及a.js上次修改时间Last-Modified，以及a.js的Etag。</li> <li>10秒内浏览器再次请求a.js，不在请求服务器，直接使用本地缓存。</li> <li>11秒时，浏览器再次请求a.js，请求服务器，带上上次修改时间If-Modefied-Since和上次的Etag值If-None-Match。</li> <li>服务器收到浏览器的If-Modified-Since和Etag，发现有If-None-Match，则比较If-None-Match和a.js的Etag值，忽略If-Modified-Since的比较。</li> <li>a.js文件内容没变化，则Etag和If-None-Match一致，服务器告诉浏览器继续使用本地缓存(304)</li> <li>如此往复。</li></ul> <h2 id="_7、结束了吗"><a href="#_7、结束了吗" class="header-anchor">#</a> 7、结束了吗？</h2> <p>到此就结束了吗？是的，HTTP缓存机制就是如此了，但是仍然存在一个问题：</p> <p>浏览器无法主动得知服务器上的a.js资源变化了。</p> <p>不管用Expires还是Cache-Control，他们都只能够控制缓存是否过期，但是在缓存过期之前，浏览器是无法得知服务器上的资源是否变化的。只有当缓存过期后，浏览器才会发请求询问服务器。</p> <h2 id="_8、最终方案"><a href="#_8、最终方案" class="header-anchor">#</a> 8、最终方案</h2> <p>大家可以想象我们使用a.js的场景，我们一般都是输入网址，访问一个html文件，html文件中会引入js、css、图片等资源。</p> <p>所以呢，我们在html上做一些手脚。</p> <p>我们不让html文件缓存，每次访问html都去请求服务器。所以浏览器每次都能拿到最新的html资源。</p> <p>a.js内容更新的时候，我们修改一下html中a.js的版本号。</p> <ul><li>第一次访问html</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;a.js?version=1&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li>浏览器下载verison=1版本的a.js文件。</li> <li>浏览器再次访问html，发现还是verison=1的a.js文件，则使用本地缓存。</li> <li>某一天a.js变了，我们的html文件也相应变化如下：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;a.js?version=2&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li>浏览器再次访问html，发现version=2的a.js资源没有缓存，则请求服务器，服务器返回最新的。</li> <li>如此往复</li></ul> <p>所以，通过设置html不缓存，html引用资源内容变化则改变资源路径的方式，九解决了无法及时得知资源更新的问题。</p> <p>当然除了以版本号来区分，也可以以MD5Hash值来区分，如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;a.[hash].js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>使用webpack打包的话，借助插件可以很方便的处理。</p> <h2 id="_9、补充"><a href="#_9、补充" class="header-anchor">#</a> 9、补充</h2> <p>Cache-Control除了可以设置max-age相对过期时间以外，还可以设置成如下几种值：</p> <ul><li>public，资源允许被中间服务器缓存。</li></ul> <p><strong>浏览器请求服务器时，如果缓存时间没到，中间服务器直接返回给浏览器内容，而不必请求源服务器</strong></p> <ul><li>private，资源不允许被中间代理服务器缓存。</li></ul> <p><strong>浏览器请求服务器时，中间服务器都要把浏览器的请求透传给服务器</strong></p> <ul><li>no-cache，浏览器不做缓存检查</li></ul> <p><strong>每次访问资源，浏览器都要向服务器询问，如果文件没变化，服务器只告诉浏览器继续使用缓存(304)</strong></p> <ul><li>no-store，浏览器和中间服代理服务器都不能缓存资源</li></ul> <p><strong>每次访问资源，浏览器都必须请求服务器，并且，服务器不去检查文件是否变化，而是直接返回完整的资源</strong></p> <ul><li>must-revalidate，可以缓存，但是使用之前必须先向源服务器确认。</li> <li>proxy-revalidate，要求缓存服务器对缓存资源向源服务器进行确认。</li> <li>s-maxage，缓存服务器对资源缓存的最大时间。</li></ul> <p>Cache-Control对缓存的控制粒度更细，包括缓存代理服务器的缓存控制。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/interview-questions/0、HTTP/6.html" class="prev">
        6、GET和POST有什么区别
      </a></span> <span class="next"><a href="/interview-questions/0、HTTP/8.html">
        8、跨域
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3063c5d8.js" defer></script><script src="/assets/js/2.142bab56.js" defer></script><script src="/assets/js/136.b851a046.js" defer></script>
  </body>
</html>
