# 10、将虚拟dom转换为真实dom

``` js
// src/init.js
Vue.prototype.$mount = function(el) {
  const vm = this
  const options = vm.$options
  el = document.querySelector(el)
  vm.$el = el

  ...
}
```

``` js
// src/lifecycle.js
import {patch} from './vdom/patch'

export function lifecycleMixin(Vue) {
  Vue.prototype._update = function(vnode) {
    // 既有初始化又有更新
    const vm = this
    patch(vm.$el, vnode)
  }
}
...
```

``` js
// src/vdom/patch.js

export function patch(oldVnode, vnode){
  if(oldVnode.nodeType === 1) { // 真是元素，第一次更新
    // 用vnode来生成真实dom替换原来的dom元素
    
    const parentEl = oldVnode.parentNode

    let elm = createElm(vnode) // 根据虚拟节点创建元素
    parentEl.insertBefore(elm, oldVnode.nextSibling)

    parentEl.removeChild(oldVnode)

  }
}

function createElm(vnode) {
  let {
    tag,
    data,
    children,
    text,
    vm
  } = vnode

  if(typeof tag === 'string') { // 元素
    vnode.el = document.createElement(tag)

    children.forEach(child=>{
      vnode.el.appendChild(createElm(child))
    })
  } else {
    vnode.el = document.createTextNode(text)
  }

  return vnode.el
}
```